//
// Created by leo on 2019/7/30.
//
#include <cstring>    // sizeof()
#include <iostream>
#include <string>
#include <sstream>  // stringstream
// headers for socket(), getaddrinfo() and friends
#include <arpa/inet.h>
#include <netdb.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <unistd.h>    // close()
#include <algorithm>  // remove_if()
#include <cctype>  // isspace
#include <vector>
#ifndef TCP_SERVER_TCP_SERVER_H
#define TCP_SERVER_TCP_SERVER_H

#define SEND_LENGTH 30
#define RECEIVE_LENGTH 30
#define LOCAL_PORT "9090"

#define FORWARD         "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x7f\x7c\xfd\xfd"
#define BACKWARD        "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\x7f\x7f\x7f\x83\xfd\xfd"
#define LEFT            "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x00\x7f\x7f\x7c\xfd\xfd"
#define RIGHT           "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\xff\x7f\x7f\x83\xfd\xfd"
#define TURN_LEFT       "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x00\x7f\x7c\xfd\xfd"
#define TURN_RIGHT      "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\xff\x7f\x83\xfd\xfd"
#define UP              "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x7f\x00\x7c\xfd\xfd"
#define DOWN            "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x7f\xff\x83\xfd\xfd"

#define HALF_FORWARD    "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f\x7f\x7f\x7f\x7c\xfd\xfd"
#define HALF_BACKWARD   "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xbf\x7f\x7f\x7f\x83\xfd\xfd"
#define HALF_LEFT       "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x3f\x7f\x7f\x7c\xfd\xfd"
#define HALF_RIGHT      "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\xbf\x7f\x7f\x83\xfd\xfd"
#define HALF_TURN_LEFT  "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x3f\x7f\x7c\xfd\xfd"
#define HALF_TURN_RIGHT "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\xbf\x7f\x83\xfd\xfd"
#define HALF_UP         "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x7f\x3f\x7c\xfd\xfd"
#define HALF_DOWN       "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x7f\xbf\x83\xfd\xfd"
#define SLEEP           "\xfe\xfe\x03\x00\x03\xb6\x03\xb6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\x7f\x7f\x7f\x03\xfd\xfd"

class TCP_Server {
public:
    int isOneLeak = 0;
    int isTwoLeak = 0;
    float depth = 0;
    std::string receive_data;
    int newFD;

    TCP_Server();
    void recvMsg();
    void sendMsg(int move);
    void release();
private:
    int is_new = 0;
    int sockFD;
    char receive[RECEIVE_LENGTH];
    addrinfo *res;
    std::string response;
    sockaddr_storage client_addr;
    socklen_t client_addr_size = sizeof(client_addr);
};

#endif //TCP_SERVER_TCP_SERVER_H
